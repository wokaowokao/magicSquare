<!DOCTYPE html>
<html>
<head>
	<title></title>
	<style type="text/css">
		.a{
			display: flex;
			width: 36px;
			margin: 2px;
		}
		.row{
			display: flex;
			flex-basis: 100%;
		}
		.container{
			display: flex;
			flex-wrap: wrap;
			background: black;
			justify-content: center;
			width: 120px;
			height: 120px;
			float: left;
			margin: 20px;
		}
		.container_bottom{
			display: flex;
			flex-wrap: wrap;
			background: black;
			justify-content: center;
			width: 120px;
			height: 120px;
			float: left;
			margin: 20px;
			margin-left: 180px;
		}
		.container_top{
			display: flex;
			justify-content: center;
			flex-wrap: wrap;
			background: black;
 
			width: 120px;
			height: 120px;
			margin: 20px;
			margin-left: 180px;
		}
		.red{
			background: red;
		}
		.blue{
			background: blue;
		}
		.yellow{
			background: yellow;
		}
		.green{
			background: green;
		}
		.white {
			background: white;
		}
		.orange {
			background: orange;
		}
		.step{
			color: blue;
		}
	</style>
	<script type="text/javascript" src="http://apps.bdimg.com/libs/jquery/1.6.4/jquery.min.js"></script>
</head>
<body>
<div class="container_top c_5">
	<div class="row">
		<div class="a yellow">1</div><div class="a yellow">1</div><div class="a yellow">1</div>
	</div>
	<div class="row">
		<div class="a yellow">1</div><div class="a yellow">1</div><div class="a yellow">1</div>
	</div>
	<div class="row">
		<div class="a yellow">1</div><div class="a yellow">1</div><div class="a yellow">1</div>
	</div>
</div>
<div class="container c_4">
	<div class="row">
		<div class="a orange">1</div><div class="a orange">1</div><div class="a orange">1</div>
	</div>
	<div class="row">
		<div class="a orange">1</div><div class="a orange">1</div><div class="a orange">1</div>
	</div>
	<div class="row">
		<div class="a orange">1</div><div class="a orange">1</div><div class="a orange">1</div>
	</div>
</div>
<div class="container c_1">
	<div class="row">
		<div class="a blue">1</div><div class="a blue">1</div><div class="a blue">1</div>
	</div>
	<div class="row">
		<div class="a blue">1</div><div class="a blue">1</div><div class="a blue">1</div>
	</div>
	<div class="row">
		<div class="a blue">1</div><div class="a blue">1</div><div class="a blue">1</div>
	</div>
</div>
<div class="container c_2">
	<div class="row">
		<div class="a red">1</div><div class="a red">1</div><div class="a red">1</div>
	</div>
	<div class="row">
		<div class="a red">1</div><div class="a red">1</div><div class="a red">1</div>
	</div>
	<div class="row">
		<div class="a red">1</div><div class="a red">1</div><div class="a red">1</div>
	</div>
</div>
<div class="container c_3">
	<div class="row">
		<div class="a green">1</div><div class="a green">1</div><div class="a green">1</div>
	</div>
	<div class="row">
		<div class="a green">1</div><div class="a green">1</div><div class="a green">1</div>
	</div>
	<div class="row">
		<div class="a green">1</div><div class="a green">1</div><div class="a green">1</div>
	</div>
</div>
<div style="clear: both;"></div>
<div class="container_bottom c_6">
	<div class="row">
		<div class="a white">1</div><div class="a white">1</div><div class="a white">1</div>
	</div>
	<div class="row">
		<div class="a white">1</div><div class="a white">1</div><div class="a white">1</div>
	</div>
	<div class="row">
		<div class="a white">1</div><div class="a white">1</div><div class="a white">1</div>
	</div>
</div>
<div style="clear: both;"></div>
<button type="button" onclick="horizontalTurn(1)">水平1层右转(11)</button>
<button type="button" onclick="horizontalTurn(2)">水平2层右转(12)</button>
<button type="button" onclick="horizontalTurn(3)">水平3层右转(13)</button>
<button type="button" onclick="horizontalTurn(4)">水平1层左转(14)</button>
<button type="button" onclick="horizontalTurn(5)">水平2层左转(15)</button>
<button type="button" onclick="horizontalTurn(6)">水平3层左转(16)</button>
</br>
<button type="button" onclick="verticalTurn(1)">垂直1层下转(21)</button>
<button type="button" onclick="verticalTurn(2)">垂直2层下转(22)</button>
<button type="button" onclick="verticalTurn(3)">垂直3层下转(23)</button>
<button type="button" onclick="verticalTurn(4)">垂直1层上转(24)</button>
<button type="button" onclick="verticalTurn(5)">垂直2层上转(25)</button>
<button type="button" onclick="verticalTurn(6)">垂直3层上转(26)</button>
</br>
<button type="button" onclick="planeTurn(1)">侧1层右转(31)</button>
<button type="button" onclick="planeTurn(2)">侧2层右转(32)</button>
<button type="button" onclick="planeTurn(3)">侧3层右转(33)</button>
<button type="button" onclick="planeTurn(4)">侧1层左转(34)</button>
<button type="button" onclick="planeTurn(5)">侧2层左转(35)</button>
<button type="button" onclick="planeTurn(6)">侧3层左转(36)</button>
</br>
<button type="button" onclick="upset()">打乱</button>
<button type="button" onclick="goback()">后退</button>
<div class="run">第一步(黄中心归位)：<span class="step"></span><button type="button" onclick="run(1)">执行</button></div>
<div class="run">第二步(黄周围白4点归位)：<span class="step"></span><button type="button" onclick="run(2)">执行</button></div>
<div class="run">第三步(白十字归位)：<span class="step"></span><button type="button" onclick="run(3)">执行</button></div>

<script type="text/javascript">
var arr =[];
var foo = [];
var allStep = [];
//生成arr数组
for (var i = 1; i <= 6*9; i++) {
	foo.push(i);
	if (i % 3 == 0) {
		var a = Math.ceil(i/9);
    	arr[a] = arr[a] || [];
    	arr[a].push(foo);
      	foo = [];
    }
}
function _show(){
	for (var i = 1; i <= 6; i++) {
		for (var j = 0; j < 3; j++) {
			arr[i][j].forEach(function(v,k){
				var color = getColor(v);
				var index = j*3+k+1;
				display(i,index,v,color);
			})
		}
	}
}
//v 123456  index 123456789
function display(v,index,num,color){
	index = index -1;
	//console.log(v+'_'+index+'_'+num);
	var node = $('.c_'+v).find('.a').eq(index);
	node.html(num);
	node.removeClass('white');
	node.removeClass('red');
	node.removeClass('blue');
	node.removeClass('orange');
	node.removeClass('green');
	node.removeClass('yellow');
	node.addClass(color);
}
function getColor(index){
	if(index <= 9) return 'white';
	if(index > 9 && index <= 18) return'red';
	if(index > 18 && index <= 27) return'yellow';
	if(index > 27 && index <= 36) return'orange';
	if(index > 36 && index <= 45) return'green';
	if(index > 45 && index <= 54) return'blue';
}

//垂直转
function verticalTurn(type,noAddStep){
	var foo = array = [];
	if(type > 0 && type <= 3){
		var typeNum = type - 1;
		array = [5,1,6,3];
	}else{
		var typeNum = type - 4;
		array = [6,3,5,1];
	}
	array.forEach(function(v){
		for (var i = 0; i < 3; i++) {
			if(v == 3) {
				if(typeNum == 0) foo.push(arr[v][i][2]);
				if(typeNum == 1) foo.push(arr[v][i][typeNum]);
				if(typeNum == 2) foo.push(arr[v][i][0]);
			}else{
				foo.push(arr[v][i][typeNum]);
			}
		}
	})
	var num = 0;
	[1,6,3,5].forEach(function(v){
		for (var i = 0; i < 3; i++) {
			if(v == 3) {
				if(typeNum == 0) arr[v][i][2] = foo[num];
				if(typeNum == 1) arr[v][i][typeNum] = foo[num];
				if(typeNum == 2) arr[v][i][0] = foo[num];
			}else{
				arr[v][i][typeNum] = foo[num];
			}
			num++;
		}
	})
	//转侧面
	if(type == 1){turnSurface(4,1);}
	if(type == 3){turnSurface(2,0);}
	if(type == 4){turnSurface(4,0);}
	if(type == 6){turnSurface(2,1);}
	noAddStep || allStep.push('2'+type);
	_show();
}
//水平转
function horizontalTurn(type,noAddStep){
	var foo = [];
	var n = 0;
	if(type>0 && type<=3){
		n = type-1;
		foo.push(arr[4][n]);
		foo.push(arr[1][n]);
		foo.push(arr[2][n]);
		foo.push(arr[3][n]);
	}
	if(type >3 && type<=6){
		n = type-4;
		foo.push(arr[2][n]);
		foo.push(arr[3][n]);
		foo.push(arr[4][n]);
		foo.push(arr[1][n]);	
	}		
	arr[1][n] = foo[0];
	arr[2][n] = foo[1];
	arr[3][n] = foo[2];
	arr[4][n] = foo[3];

	//转顶或底面
	if(type == 1){turnSurface(5,0);}
	if(type == 3){turnSurface(6,1);}
	if(type == 4){turnSurface(5,1);}
	if(type == 6){turnSurface(6,0);}
	noAddStep || allStep.push('1'+type);
	_show();
}
//面转
function planeTurn(type,noAddStep){
	allTurn(3);
	horizontalTurn(type,1);
	allTurn(4);
	noAddStep || allStep.push('3'+type);
	_show();
}
//整体转 1234 1水平右 2水平左 3垂直下 4垂直上
function allTurn(type){
	var foo = [];
	if(type == 1){
		foo = arr[1];
		arr[1] = arr[4];
		arr[4] = arr[3];
		arr[3] = arr[2];
		arr[2] = foo;
		turnSurface(5);
		turnSurface(6,1);
	}
	if(type == 2){
		foo = arr[1];
		arr[1] = arr[2];
		arr[2] = arr[3];
		arr[3] = arr[4];
		arr[4] = foo;
		turnSurface(5,1);
		turnSurface(6);
	}
	if(type == 3){
		foo = arr[1];
		arr[1] = arr[5];
		arr[5] = arr[3];
		arr[3] = arr[6];
		arr[6] = foo;
		turnSurface(3,1);
		turnSurface(3,1);
		turnSurface(5,1);
		turnSurface(5,1);
		turnSurface(4,1);
		turnSurface(2);
	}	
	if(type == 4){
		foo = arr[1];
		arr[1] = arr[6];
		arr[6] = arr[3];
		arr[3] = arr[5];
		arr[5] = foo;
		turnSurface(3,1);
		turnSurface(3,1);
		turnSurface(6,1);
		turnSurface(6,1);
		turnSurface(4);
		turnSurface(2,1);
	}	
	_show();
}
//砖面方法 n为面编号   rotationSense为1 顺时针 只转一个面
function turnSurface(n,rotationSense){
	var array = [arr[n][0][0],arr[n][0][1],arr[n][0][2],arr[n][1][2],arr[n][2][2],arr[n][2][1],arr[n][2][0],arr[n][1][0]];
	var foo = _turnSurface(array,rotationSense);
	
	arr[n][0][0] = foo[0];
	arr[n][0][1] = foo[1];
	arr[n][0][2] = foo[2];
	arr[n][1][2] = foo[3];
	arr[n][2][2] = foo[4];
	arr[n][2][1] = foo[5];
	arr[n][2][0] = foo[6];
	arr[n][1][0] = foo[7];
	_show()
}
//type为1顺时针
function _turnSurface(arr,type){
	arr.push(arr[0],arr[1]);
	arr.unshift(arr[6],arr[7]);
	if(type) return arr.slice(0,8);
	else return arr.slice(4);
}
//output 123456
function getFaceIndex(val){
	var num = '';
	arr.forEach(function(v,k){
		v.forEach(function(v2){
			v2.forEach(function(v3){
				if(v3 == val){
					num = k;
				}
			})
		})
	})
	return num;
}
//步骤执行
function run(step){
	if(step == 1){
		var num = getFaceIndex(23);
		var val = '';
		//console.log(num);
		if(num == 1){
			horizontalTurn(2);
			horizontalTurn(2);
		}
		if(num == 2){
			horizontalTurn(2);
		}
		if(num == 3){
			return false;
		}
		if(num == 4){
			horizontalTurn(5);
		}
		if(num == 5){
			verticalTurn(5);
		}
		if(num == 6){
			verticalTurn(2);
		}
	}
	if(step == 2) {
		//处理可以直接 上的白块
		runType2();
		//处理 通过转3面 可以上的白块
		runType21();
		//处理其他白块
		setTimeout(runType22, 300 );
		//setTimeout("allTurn(1)", 1000 );
		//setTimeout("allTurn(1)", 1000 );

		
	}
	//step == 3 && runType3();
}
function runType2Check(){
	if(9 < arr[3][0][1]) return false;
	if(9 < arr[3][1][2]) return false;
	if(9 < arr[3][2][1]) return false;
	if(9 < arr[3][1][0]) return false;
	return true;
}
//黄 周围白点
function runType2(){
	var foo = [0,0,0,0];
	if(9 >= arr[3][0][1]) foo[0] = 1;
	if(9 >= arr[3][1][2]) foo[1] = 1;
	if(9 >= arr[3][2][1]) foo[2] = 1;
	if(9 >= arr[3][1][0]) foo[3] = 1;
	 
	foo.forEach(function(v,k){
		!v && _runType2(k);
	})
}
function _runType2(k) {
	if(k == 0){
		if(isWhite(arr[4][0][1])){
			horizontalTurn(4);
		} 
		if(isWhite(arr[1][0][1])){
			horizontalTurn(4);
			horizontalTurn(4);
			
		}
		if(isWhite(arr[2][0][1])){
			horizontalTurn(1);
		}
	}
	if(k == 1){
		if(isWhite(arr[5][1][0])){
			verticalTurn(4);
		} 
		if(isWhite(arr[1][1][0])){
			verticalTurn(4);
			verticalTurn(4);
			
		}
		if(isWhite(arr[6][1][0])){
			verticalTurn(1);
		}
	}
	if(k == 2){
		if(isWhite(arr[4][2][1])){
			horizontalTurn(6);
		} 
		if(isWhite(arr[1][2][1])){
			horizontalTurn(6);
			horizontalTurn(6);
			
		}
		if(isWhite(arr[2][2][1])){
			horizontalTurn(3);
		}
	}
	if(k == 3){
		if(isWhite(arr[5][1][2])){
			verticalTurn(6);
		} 
		if(isWhite(arr[1][1][2])){
			verticalTurn(6);
			verticalTurn(6);
			
		}
		if(isWhite(arr[6][1][2])){
			verticalTurn(3);
		}
	}
}
function runType21() {
	var array = [];
	arr.forEach(function(v,k){
		if(k == 3) return;
		v.forEach(function(v2,k2){
			v2.forEach(function(v3,k3){
				//屏蔽角点 和非白点
				if(v3 > 9) return;
				if(k2 == 0 && k3 == 0) return;
				if(k2 == 0 && k3 == 2) return;
				if(k2 == 2 && k3 == 0) return;
				if(k2 == 2 && k3 == 2) return;
				if(k2 == 1 && k3 == 1) return;
				if(hasLocation([k,k2,k3])){
					array.push([k,k2,k3]);
				}
			})
		})
	})
	array.length && _runType21(array);
}
//array为 没到位的白块
function _runType21(array){
	array.forEach(function(){
		for (var i = 0; i < 3; i++) {
		/*var a = runType2Check();
		if(a) break;*/
			turnSurface(3);
			runType2();
		}
	})
}
//处理其他白块
function runType22(){
	var array = [];
	arr.forEach(function(v,k){
		if(k == 3) return;
		v.forEach(function(v2,k2){
			v2.forEach(function(v3,k3){
				//屏蔽角点 和非白点
				if(v3 > 9) return;
				if(k2 == 0 && k3 == 0) return;
				if(k2 == 0 && k3 == 2) return;
				if(k2 == 2 && k3 == 0) return;
				if(k2 == 2 && k3 == 2) return;
				if(k2 == 1 && k3 == 1) return;
				array.push([k,k2,k3]);
			})
		})
	})
	_runType22(array);
	runType2();
	runType21();
}
function _runType22(array){
	var foo = [];
	array.forEach(function(v,k){
		if($.inArray(v[0], foo) != -1) return;
		foo.push(v[0]);
		turnSurface(v[0]);
	})
}
//检查 这个点 是否被占 return 1 已经被占
function hasLocation(array){
	if (array[0] == 5 || array[0] == 6) {
		if(array[1] == 1){
			if(array[2] == 0) array[2] = 2;
			else array[2] = 0;
		}
	}
	if(arr[3][array[1]][array[2]] < 9) return 1;
	else return 0;
}
function isWhite(val){
	if(9 >= val) return 1;
	else return 0;
}
//执行
function excute(array){
	for (var i = 0; i < 20; i++) {
		var val = array[i].substring(0,1);
		var num = array[i].substring(1,2);
		val == 1 && horizontalTurn(num);
		val == 2 && verticalTurn(num);
		val == 3 && planeTurn(num);
	}
}
//打乱
function upset(){
	for (var i = 0; i < 20; i++) {
		var val = Math.round(Math.random()*2);
		var num = Math.round(Math.random()*5+1);
		val == 0 && horizontalTurn(num);
		val == 1 && verticalTurn(num);
		val == 2 && planeTurn(num);
	}
	console.log(allStep);
}
//后退
function goback(){
	var foo = allStep[allStep.length-1];
	if(foo.substring(0,1) == '1'){
		horizontalTurn(_goback(foo.substring(1,2)),1);
	}
	if(foo.substring(0,1) == '2'){
		verticalTurn(_goback(foo.substring(1,2)),1);
	}
	if(foo.substring(0,1) == '3'){
		planeTurn(_goback(foo.substring(1,2)),1);
	}
	allStep.pop();
}
function _goback(val){
	if(val == '1') return '4';
	if(val == '2') return '5';
	if(val == '3') return '6';
	if(val == '4') return '1';
	if(val == '5') return '2';
	if(val == '6') return '3';
}

;!function(a){
	"use strict";
	var b = [0,0,0,0];
	a.stepType3 = {
		a : function(){
			var foo = b;
			var _this = this.stepType3;
			foo.forEach(function(v,k){
				if(v == 1) return;
				k == 0 && _this.b(arr[5][1][1],arr[5][2][1]) && _this.d(k);
				k == 1 && _this.b(arr[2][1][0],arr[2][1][1]) && _this.d(k);
				k == 2 && _this.b(arr[6][0][1],arr[5][1][1]) && _this.d(k);
				k == 3 && _this.b(arr[5][1][1],arr[5][2][1]) && _this.d(k);
			})
			return b;
		},//检查并转 并改数组
		b : function(a,b){
			return Math.floor(a/9) == Math.floor(b/9) ? 1 : 0;
		},
		c : function(){
			planeTurn(3);
		},
		d : function(a){
			if(a == 0){
				horizontalTurn(1);
				horizontalTurn(1);
			}
			if(a == 1){
				verticalTurn(3);
				verticalTurn(3);
			}
			if(a == 2){
				horizontalTurn(3);
				horizontalTurn(3);
			}
			if(a == 3){
				verticalTurn(1);
				verticalTurn(1);
			}
			b[a] = 1;
		},
		e : function(){
			var a = 1;
			for (var i = 0; i <= 3; i++) {
				if(b[i] == 0) {
					a = 0;
					return a;
				}
			}
			return a;
		}
	};
}(window);

!function(a){
	a.a = {
		a:[0,1],
		b:function(){
			console.log(this);
			var b = this.a;
			b.forEach(function(){
				console.log(this);
			})
		}
	}
}(window)
a.b();
$(function(){
	_show();
})

</script>
</body>
</html>
